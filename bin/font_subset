#!/usr/bin/env bash

# Colors for logging
GREEN='\033[0;32m'
RED='\033[0;31m'
BLUE='\033[0;34m'
CYAN='\033[0;36m'
NC='\033[0m' # No Color

font_path="$1"

if ! command -v pyftsubset &> /dev/null; then
    echo -e "${RED}âœ– æœªæ‰¾åˆ° pyftsubset å‘½ä»¤ã€‚${NC}è¯·ä½¿ç”¨ 'pip install fonttools' å‘½ä»¤å®‰è£…ã€‚"
    exit 1
fi

echo -e "${BLUE}ğŸŒ æ­£åœ¨ä¸‹è½½ Unicode å­—ç¬¦é›†...${NC}"
curl -s -o "$HOME/.cache/sc_unicode.txt" https://gist.githubusercontent.com/Efterklang/52df37f3daba9a2d0f193d69e5181d37/raw/7ca17bb7c29b3eb72b5c4094904b3b4f06d61829/sc_unicode.txt

echo -e "${BLUE}ğŸš€ æ­£åœ¨ä½¿ç”¨ pyftsubset æ‹†åˆ†å­—ä½“...${NC}"
pyftsubset "$font_path" --unicodes-file="$HOME/.cache/sc_unicode.txt" --flavor=woff2

output_file="${font_path%.*}.subset.woff2"

echo -e "${GREEN}âœ… å­—ä½“å‹ç¼©å®Œæˆï¼${NC}"
echo -e "  - æºæ–‡ä»¶: ${CYAN}$font_path${NC} ($(du -h "$font_path" | cut -f1))"
echo -e "  - è¾“å‡ºæ–‡ä»¶: ${CYAN}$output_file${NC} ($(du -h "$output_file" | cut -f1))"